sumeru.config({httpServerPort:8080,sumeruPath:"/../sumeru"}),sumeru.router.add({pattern:"/itworks",action:"App.itworks"}),App.itworks=sumeru.controller.create(function(e,t){e.onrender=function(e){e("itworks",["push","left"])}}),sumeru.router.add({pattern:"/savewithvalidation",action:"App.saveWithValidation"}),sumeru.router.setDefault("App.saveWithValidation"),App.saveWithValidation=sumeru.controller.create(function(e,t){var n=function(e){return document.getElementById(e)},r=function(){t.sduser=e.subscribe("pub-sduser",function(e){t.bind("sduserlist",{data:e})})};e.onload=function(){return[r]};var i=function(){sumeru.log("onload nothing")};e.onerror=function(){sumeru.log("App.saveWithValidation error.")},e.onrender=function(e){e("saveWithValidation",["rotate","left"])},e.onready=function(e){var r=function(){n("sdnameerror").innerHTML="&nbsp;",n("sdageerror").innerHTML="&nbsp;"};t.sduser.onValidation=function(e,t,i){e&&r(),n("sdvalidation").innerHTML=("client"==t?"客户端":"服务端")+(1==e?"验证通过":"验证失败")+"<br/>";for(var o=i.length-1;o>=0;o--)n("sd"+i[o].key+"error").innerHTML+=("client"==t?"客户端":"服务端")+"验证结果："+i[o].msg;e||this.rollback(),"server"==t&&(e&&this.isEnsureSave()||!e&&!this.isEnsureSave())&&this.render()},Library.touch.on("#sdsave","touchstart",function(){r();var e=n("sdname").value,i=n("sdage").value;t.sduser.add({name:e,age:i}),t.sduser.save()}),Library.touch.on("#sdensuresave","touchstart",function(){r();var e=n("sdname").value,i=n("sdage").value;t.sduser.add({name:e,age:i}),t.sduser.ensureSave()})}}),Model.sduser=function(e){e.config={fields:[{name:"name",type:"string",validation:"length[1,20]|unique"},{name:"age",type:"int",validation:"length[1,3]"},{name:"userid",type:"int"}]}};
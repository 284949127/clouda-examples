sumeru.config({httpServerPort:8080,sumeruPath:"/../sumeru"}),sumeru.router.add({pattern:"/itworks",action:"App.itworks"}),App.itworks=sumeru.controller.create(function(e,t){e.onrender=function(e){e("itworks",["push","left"])}}),sumeru.router.add({pattern:"/cloudaauth",action:"App.cloudaAuth"}),App.cloudaAuth=sumeru.controller.create(function(e,t){e.onrender=function(e){e("cloudaAuth",["push","left"])};var n=sumeru.auth.create(e);e.onready=function(){document.getElementById("login").addEventListener("click",a),document.getElementById("register").addEventListener("click",r),document.getElementById("logout").addEventListener("click",i)};var r=function(){e.redirect("/register")},i=function(){n.logout(),alert("退出成功！")},o=function(e,t){if(e)return alert("登录失败！错误信息："+e.msg+"  ----"+t),void 0;switch(t){case"not_login":break;case"logined":document.getElementById("popup").style.display="none",userInfo=n.getUserInfo(),document.getElementById("show_userinfo").innerHTML="username:"+userInfo.token+"  gender:"+userInfo.info.gender+"  userid:"+userInfo.userId;break;case"doing_login":document.getElementById("popup").style.display="block"}};n.on("statusChange",o);var a=function(){var e=document.getElementById("username").value,t=document.getElementById("password").value,r=document.getElementById("age").value,i;n.login(e,t,{age:r},"local")}}),sumeru.router.add({pattern:"/register",action:"App.register"}),App.register=sumeru.controller.create(function(e,t){e.onrender=function(e){e("register",["push","left"])};var n=sumeru.auth.create(e);e.onready=function(){document.getElementById("submit").addEventListener("click",r)};var r=function(){for(var t=document.getElementById("register_username").value,r=document.getElementById("register_password").value,i=document.getElementById("register_age").value,o=document.getElementsByName("register_gender"),a,s=0;s<o.length;s++)if(o[s].checked){a=o[s].value;break}n.registerValidate({token:t,age:i},"local",function(o,s){s?n.register(t,r,{age:i,gender:a},"local",function(t){return t?(alert("zhuceshibai!"),void 0):(e.redirect("/cloudaauth"),void 0)}):alert("验证失败，error code:"+o.code+" ,error message："+o.msg)})}});
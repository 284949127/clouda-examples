sumeru.config({httpServerPort:8080,sumeruPath:"/../sumeru"}),sumeru.router.add({pattern:"/itworks",action:"App.itworks"}),App.itworks=sumeru.controller.create(function(e,t){e.onrender=function(e){e("itworks",["push","left"])}}),sumeru.router.add({pattern:"/chatchannel",action:"App.todos"}),sumeru.router.setDefault("App.todos"),App.todos=sumeru.controller.create(function(e,t){var n=function(){t.get("tag")||t.set("tag","all"),t.messages=e.subscribe("pub-todos",t.get("tag"),function(e){e.addSorters("time","DESC"),t.bind("todos",{data:e.find(),isAllChecked:0==e.find({completed:!1}).length,isChecked:e.find({completed:!0}).length>0,unCompleted:e.find({completed:!1}).length,commpleted:e.find({completed:!0}).length})})};e.onload=function(){return[n]},e.onrender=function(e){e("todos",["push","left"])},e.onready=function(){var e="click",n,o={enter:13},a=function(e){return document.getElementById(e)};t.event("todos",function(){t.eventMap("#new-todo",{keydown:function(e){e.keyCode==o.enter&&i()},focus:function(e){t.messages.hold()},blur:function(e){""==this.value.trim()&&t.messages.releaseHold()}}),document.getElementById("toggle-all").addEventListener(e,r),document.getElementById("main").addEventListener(e,function(e){var e=e||window.event,n=e.target||e.srcElement;if("button"==n.tagName.toLowerCase()&&n.hasAttribute("data-id")){var r=n.getAttribute("data-id");t.messages.destroy({smr_id:r}),t.messages.save()}if("input"==n.tagName.toLowerCase()&&n.hasAttribute("data-id")&&n.hasAttribute("status")){var r=n.getAttribute("data-id"),i=n.getAttribute("status");i?t.messages.update({completed:!1},{smr_id:r}):t.messages.update({completed:!0},{smr_id:r}),t.messages.save()}}),document.getElementById("footer").addEventListener(e,function(e){var e=e||window.event,n=e.target||e.srcElement;if("button"==n.tagName.toLowerCase()&&(t.messages.destroy({completed:!0}),t.messages.save()),"li"==n.tagName.toLowerCase()&&n.hasAttribute("tag")){var r=n.getAttribute("tag");"all"==r&&(t.set("tag","all"),t.commit()),"active"==r&&(t.set("tag","active"),t.commit()),"completed"==r&&(t.set("tag","completed"),t.commit())}})})};var r=function(){if(document.getElementById("toggle-all").checked)for(var e=document.getElementsByClassName("toggle"),t=0;t<e.length;t++)a(e[t].value);else for(var e=document.getElementsByClassName("toggle"),t=0;t<e.length;t++)s(e[t].value)},i=function(){var e=document.getElementById("new-todo"),n=e.value.trim();return""==n?!1:(t.messages.add({task:n,completed:!1}),t.messages.save(),e.value="",t.messages.releaseHold(),void 0)},o=function(e){t.messages.destroy({time:"todo_time"}),t.messages.save()},a=function(e){e-=0,t.messages.update({completed:!0},{time:e}),t.messages.save()},s=function(e){e-=0,t.messages.update({completed:!1},{time:e}),t.messages.save()}}),Model.todosModel=function(e){e.config={fields:[{name:"task",type:"string",defaultValue:""},{name:"completed",type:"boolean",defaultValue:"false"},{name:"time",type:"datetime",defaultValue:"now()"}]}};